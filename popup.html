<!DOCTYPE html>
<html>
<head>
  <style>
    :root {
      --primary-color: #4CAF50;
      --primary-hover: #45a049;
      --border-radius: 8px;
      --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    body {
      width: 500px;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      background: #f9fafb;
    }

    .container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 16px;
      margin-bottom: 16px;
    }

    select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: var(--border-radius);
      font-size: 14px;
      background: white;
      margin-bottom: 16px;
      transition: all 0.2s;
    }

    select:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }

    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: var(--border-radius);
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    button:hover {
      background-color: var(--primary-hover);
      transform: translateY(-1px);
    }

    #driverInfo {
      display: none;
    }

    .section {
      border: 1px solid #e2e8f0;
      border-radius: var(--border-radius);
      margin-bottom: 12px;
      overflow: hidden;
    }

    .section-header {
      background: #f8fafc;
      padding: 12px 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 600;
      color: #1e293b;
    }

    .section-header:hover {
      background: #f1f5f9;
    }

    .section-content {
      padding: 16px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      border-top: 1px solid #e2e8f0;
    }

    .section-collapsed .section-content {
      display: none;
    }

    .section-header::after {
      content: '−';
      font-size: 20px;
      color: #64748b;
    }

    .section-collapsed .section-header::after {
      content: '+';
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field-label {
      font-size: 12px;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .field-value {
      font-size: 14px;
      color: #1e293b;
      word-break: break-word;
    }

    .empty-value {
      color: #94a3b8;
      font-style: italic;
    }

    .date-value {
      color: #0369a1;
    }

    .document-list {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .document-tag {
      font-size: 12px;
      padding: 4px 8px;
      background: #e2e8f0;
      border-radius: 12px;
      color: #475569;
    }

    #status {
      margin-top: 16px;
      padding: 12px;
      border-radius: var(--border-radius);
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .error { 
      background-color: #fef2f2; 
      color: #dc2626;
    }

    .success { 
      background-color: #f0fdf4; 
      color: #16a34a;
    }

    .loading {
      opacity: 0.7;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <select id="driverSelect">
      <option value="">Select a driver...</option>
    </select>

    <div id="driverInfo">
      <!-- Sections will be dynamically populated -->
    </div>

    <button id="fillButton">Fill Form</button>
  </div>

  <div id="status"></div>
  <script src="popup.js"></script>
  <script>
    function formatDate(dateString) {
      if (!dateString) return null;
      try {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
      } catch {
        return dateString;
      }
    }

    function formatValue(value) {
      if (value === null || value === undefined) return null;
      if (Array.isArray(value)) {
        return value.length ? value.join(', ') : null;
      }
      if (value === '') return null;
      if (typeof value === 'boolean') return value ? 'Yes' : 'No';
      if (typeof value === 'number' && value === 0) return null;
      return value;
    }

    function createField(label, value, type = 'text') {
      const formattedValue = type === 'date' ? formatDate(value) : formatValue(value);
      
      return `
        <div class="field">
          <div class="field-label">${label}</div>
          <div class="field-value ${!formattedValue ? 'empty-value' : ''} ${type === 'date' ? 'date-value' : ''}">
            ${formattedValue || 'Not provided'}
          </div>
        </div>
      `;
    }

    function showDriverInfo(driver) {
      const info = document.getElementById("driverInfo");
      if (!driver) {
        info.style.display = "none";
        return;
      }

      info.style.display = "block";

      const sections = [
        {
          title: 'Basic Information',
          fields: [
            ['First Name', driver.firstName],
            ['Last Name', driver.lastName],
            ['Email', driver.email],
            ['Created', driver.createdAt, 'date'],
            ['Updated', driver.updatedAt, 'date']
          ]
        },
        {
          title: 'Personal Information',
          fields: [
            ['Date of Birth', driver.personalInfo?.dateOfBirth, 'date'],
            ['Gender', driver.personalInfo?.gender],
            ['SSN', driver.personalInfo?.ssn],
            ['Nationality', driver.personalInfo?.nationality],
            ['Languages', driver.personalInfo?.languages]
          ]
        },
        {
          title: 'Contact Information',
          fields: [
            ['Primary Phone', driver.phone?.primary],
            ['Emergency Phone', driver.phone?.emergency]
          ]
        },
        {
          title: 'Address',
          fields: [
            ['Street', driver.address?.street],
            ['City', driver.address?.city],
            ['State', driver.address?.state],
            ['ZIP Code', driver.address?.zipCode],
            ['Country', driver.address?.country]
          ]
        },
        {
          title: 'License Information',
          fields: [
            ['License Number', driver.license?.number],
            ['License Type', driver.license?.type],
            ['Issue Date', driver.license?.issueDate, 'date'],
            ['Expiry Date', driver.license?.expiryDate, 'date'],
            ['Issuing State', driver.license?.issuingState]
          ]
        },
        {
          title: 'Employment',
          fields: [
            ['Status', driver.employment?.status],
            ['Start Date', driver.employment?.startDate, 'date'],
            ['Employee ID', driver.employment?.employeeId],
            ['Department', driver.employment?.department],
            ['Position', driver.employment?.position]
          ]
        },
        {
          title: 'Vehicle Information',
          fields: [
            ['Type', driver.vehicle?.type],
            ['Make', driver.vehicle?.make],
            ['Model', driver.vehicle?.model],
            ['Year', driver.vehicle?.year],
            ['Plate Number', driver.vehicle?.plateNumber]
          ]
        },
        {
          title: 'Qualifications',
          fields: [
            ['Experience (years)', driver.qualifications?.experience],
            ['Skills', driver.qualifications?.skills]
          ]
        }
      ];

      info.innerHTML = sections.map(section => `
        <div class="section">
          <div class="section-header">
            ${section.title}
          </div>
          <div class="section-content">
            ${section.fields.map(([label, value, type]) => 
              createField(label, value, type)
            ).join('')}
          </div>
        </div>
      `).join('');

      // Add document section if there are any documents
      const documents = Object.entries(driver.documents || {});
      if (documents.length) {
        const documentSection = `
          <div class="section">
            <div class="section-header">Documents</div>
            <div class="section-content">
              <div class="document-list">
                ${documents.map(([type, doc]) => `
                  <div class="document-tag">
                    ${type.replace(/([A-Z])/g, ' $1').trim()}
                    ${doc?.url ? '✓' : '✗'}
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        `;
        info.innerHTML += documentSection;
      }

      // Add click handlers for section collapse/expand
      document.querySelectorAll('.section-header').forEach(header => {
        header.addEventListener('click', () => {
          header.parentElement.classList.toggle('section-collapsed');
        });
      });
    }

    function showStatus(message, isError = false) {
      const status = document.getElementById("status");
      status.textContent = message;
      status.className = isError ? "error" : "success";
    }
  </script>
</body>
</html>